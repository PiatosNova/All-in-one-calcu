@page
@model All_in_one_calcu.Pages.Calculators.MiscellaneousModel
@{
    ViewData["Title"] = "Miscellaneous Calculator";
}

<div class="calculator-layout">
    <div class="calculator-container">
        <h2 class="mb-4">Miscellaneous Calculator</h2>

        <!-- Calculator Type Selection -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="calculatorType" id="age" value="age" checked>
                    <label class="btn btn-outline-primary" for="age">
                        <i class="bi bi-calendar"></i> Age Calculator
                    </label>

                    <input type="radio" class="btn-check" name="calculatorType" id="date" value="date">
                    <label class="btn btn-outline-primary" for="date">
                        <i class="bi bi-calendar-date"></i> Date Calculator
                    </label>

                    <input type="radio" class="btn-check" name="calculatorType" id="time" value="time">
                    <label class="btn btn-outline-primary" for="time">
                        <i class="bi bi-clock"></i> Time Calculator
                    </label>

                    <input type="radio" class="btn-check" name="calculatorType" id="percentage" value="percentage">
                    <label class="btn btn-outline-primary" for="percentage">
                        <i class="bi bi-percent"></i> Percentage Calculator
                    </label>
                </div>
            </div>
        </div>

        <!-- Age Calculator -->
        <div class="card mb-4" id="ageCalculator">
            <div class="card-header">
                <h5 class="mb-0">Age Calculator</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="birthDate" class="form-label">Birth Date</label>
                            <input type="date" class="form-control" id="birthDate">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="currentDate" class="form-label">Current Date</label>
                            <input type="date" class="form-control" id="currentDate">
                        </div>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary" onclick="calculateAge()">Calculate </button>
                    </div>
                </div>

                <!-- Age Results -->
                <div class="mt-4" id="ageResults" style="display: none;">
                    <h6>Age Results</h6>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <tr>
                                <td>Years:</td>
                                <td id="ageYears">0</td>
                            </tr>
                            <tr>
                                <td>Months:</td>
                                <td id="ageMonths">0</td>
                            </tr>
                            <tr>
                                <td>Days:</td>
                                <td id="ageDays">0</td>
                            </tr>
                            <tr>
                                <td>Total Days:</td>
                                <td id="ageTotalDays">0</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Date Calculator -->
        <div class="card mb-4" id="dateCalculator" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0">Date Calculator</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate">
                        </div>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary" onclick="calculateDate()">Calculate</button>
                    </div>
                </div>

                <!-- Date Results -->
                <div class="mt-4" id="dateResults" style="display: none;">
                    <h6>Date Results</h6>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <tr>
                                <td>Days Between:</td>
                                <td id="daysBetween">0</td>
                            </tr>
                            <tr>
                                <td>Weeks Between:</td>
                                <td id="weeksBetween">0</td>
                            </tr>
                            <tr>
                                <td>Months Between:</td>
                                <td id="monthsBetween">0</td>
                            </tr>
                            <tr>
                                <td>Years Between:</td>
                                <td id="yearsBetween">0</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time Calculator -->
        <div class="card mb-4" id="timeCalculator" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0">Time Calculator</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="startTime" class="form-label">Start Time</label>
                            <input type="time" class="form-control" id="startTime">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="endTime" class="form-label">End Time</label>
                            <input type="time" class="form-control" id="endTime">
                        </div>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary" onclick="calculateTime()">Calculate</button>
                    </div>
                </div>

                <!-- Time Results -->
                <div class="mt-4" id="timeResults" style="display: none;">
                    <h6>Time Results</h6>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <tr>
                                <td>Duration:</td>
                                <td id="timeDuration">0:00</td>
                            </tr>
                            <tr>
                                <td>Hours:</td>
                                <td id="timeHours">0</td>
                            </tr>
                            <tr>
                                <td>Minutes:</td>
                                <td id="timeMinutes">0</td>
                            </tr>
                            <tr>
                                <td>Seconds:</td>
                                <td id="timeSeconds">0</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Percentage Calculator -->
        <div class="card mb-4" id="percentageCalculator" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0">Percentage Calculator</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="value" class="form-label">Value</label>
                            <input type="number" class="form-control" id="value" placeholder="Enter value">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="percentageValue" class="form-label">Percentage</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="percentageValue" placeholder="Enter percentage">
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary" type="button" onclick="calculatePercentage()">Calculate</button>
                    </div>
                </div>

                <!-- Percentage Results -->
                <div class="mt-4" id="percentageResults" style="display: none;">
                    <h6>Percentage Results</h6>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <tr>
                                <td>Percentage of Value:</td>
                                <td id="percentageOfValue">0</td>
                            </tr>
                            <tr>
                                <td>Value Increased by Percentage:</td>
                                <td id="valueIncreased">0</td>
                            </tr>
                            <tr>
                                <td>Value Decreased by Percentage:</td>
                                <td id="valueDecreased">0</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- History Panel -->
    <div class="history-panel">
        <div class="history-header">
            <h5>Recent History</h5>
            <button class="btn btn-sm btn-outline-danger" onclick="clearHistory()">Clear All</button>
        </div>
        <div class="history-list" id="historyList">
            <!-- History items will be added here dynamically -->
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let calculationHistory = [];

        document.addEventListener('DOMContentLoaded', function() {
            // Set current date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('currentDate').value = today;
            document.getElementById('endDate').value = today;

            // Calculator type selection
            const calculatorTypes = document.querySelectorAll('input[name="calculatorType"]');
            calculatorTypes.forEach(type => {
                type.addEventListener('change', function() {
                    document.getElementById('ageCalculator').style.display = 'none';
                    document.getElementById('dateCalculator').style.display = 'none';
                    document.getElementById('timeCalculator').style.display = 'none';
                    document.getElementById('percentageCalculator').style.display = 'none';
                    
                    document.getElementById(this.value + 'Calculator').style.display = 'block';
                });
            });

            // Load history from localStorage if available
            const savedHistory = localStorage.getItem('miscellaneousCalculatorHistory');
            if (savedHistory) {
                calculationHistory = JSON.parse(savedHistory);
                updateHistoryDisplay();
            }
        });

        // Function to add calculation to history
        function addToHistory(calculatorType, calculation, result) {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Format the calculation string based on calculator type
            let calculationString = '';
            
            switch(calculatorType) {
                case 'age':
                    calculationString = `Age: ${calculation.birthDate} to ${calculation.currentDate}`;
                    break;
                case 'date':
                    calculationString = `Date: ${calculation.startDate} to ${calculation.endDate}`;
                    break;
                case 'time':
                    calculationString = `Time: ${calculation.startTime} to ${calculation.endTime}`;
                    break;
                case 'percentage':
                    calculationString = `Percentage: ${calculation.value} × ${calculation.percentage}%`;
                    break;
            }
            
            // Add to beginning of array (newest first)
            calculationHistory.unshift({
                calculatorType: calculatorType,
                calculation: calculationString,
                result: result,
                timestamp: timeString,
                id: Date.now() // Unique ID for each entry
            });
            
            // Keep only the last 10 entries
            if (calculationHistory.length > 10) {
                calculationHistory.pop();
            }
            
            // Save to localStorage
            localStorage.setItem('miscellaneousCalculatorHistory', JSON.stringify(calculationHistory));
            
            // Update display
            updateHistoryDisplay();
        }

        // Function to update history display
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (calculationHistory.length === 0) {
                historyList.innerHTML = '<div class="history-empty">No calculations yet</div>';
                return;
            }
            
            calculationHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-content">
                        <div class="history-calculation">${item.calculation}</div>
                        <div class="history-result">${item.result}</div>
                        <div class="history-timestamp">${item.timestamp}</div>
                    </div>
                    <button class="btn btn-sm btn-outline-danger delete-btn" onclick="deleteHistoryItem(${item.id})">
                        <i class="bi bi-trash"></i>
                    </button>
                `;
                historyList.appendChild(historyItem);
            });
        }

        // Function to delete a history item
        function deleteHistoryItem(id) {
            calculationHistory = calculationHistory.filter(item => item.id !== id);
            localStorage.setItem('miscellaneousCalculatorHistory', JSON.stringify(calculationHistory));
            updateHistoryDisplay();
        }

        // Function to clear all history
        function clearHistory() {
            calculationHistory = [];
            localStorage.removeItem('miscellaneousCalculatorHistory');
            updateHistoryDisplay();
        }

        // --- Age Calculator ---
        function calculateAge() {
            const birthDate = new Date(document.getElementById('birthDate').value);
            const currentDate = new Date(document.getElementById('currentDate').value);

            if (isNaN(birthDate) || isNaN(currentDate)) {
                document.getElementById('ageResults').style.display = 'none';
                return;
            }

            let years = currentDate.getFullYear() - birthDate.getFullYear();
            let months = currentDate.getMonth() - birthDate.getMonth();
            let days = currentDate.getDate() - birthDate.getDate();

            if (days < 0) {
                months--;
                days += new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }

            const totalDays = Math.floor((currentDate - birthDate) / (1000 * 60 * 60 * 24));

            document.getElementById('ageYears').textContent = years;
            document.getElementById('ageMonths').textContent = months;
            document.getElementById('ageDays').textContent = days;
            document.getElementById('ageTotalDays').textContent = totalDays;
            document.getElementById('ageResults').style.display = 'block';
        }

        // --- Date Calculator ---
        function calculateDate() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);

            if (isNaN(startDate) || isNaN(endDate)) {
                document.getElementById('dateResults').style.display = 'none';
                return;
            }

            const diffTime = endDate - startDate;
            const days = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const weeks = Math.floor(days / 7);

            // Calculate months and years
            let months = (endDate.getFullYear() - startDate.getFullYear()) * 12;
            months += endDate.getMonth() - startDate.getMonth();
            if (endDate.getDate() < startDate.getDate()) months--;

            let years = Math.floor(months / 12);
            months = months % 12;

            document.getElementById('daysBetween').textContent = days;
            document.getElementById('weeksBetween').textContent = weeks;
            document.getElementById('monthsBetween').textContent = months;
            document.getElementById('yearsBetween').textContent = years;
            document.getElementById('dateResults').style.display = 'block';
        }

        // --- Time Calculator ---
        function calculateTime() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;

            if (!startTime || !endTime) {
                document.getElementById('timeResults').style.display = 'none';
                return;
            }

            const [startHour, startMinute] = startTime.split(':').map(Number);
            const [endHour, endMinute] = endTime.split(':').map(Number);

            let start = new Date(0, 0, 0, startHour, startMinute, 0);
            let end = new Date(0, 0, 0, endHour, endMinute, 0);

            let diff = (end - start) / 1000;
            if (diff < 0) diff += 24 * 60 * 60;

            const hours = Math.floor(diff / 3600);
            diff -= hours * 3600;
            const minutes = Math.floor(diff / 60);
            const seconds = Math.floor(diff % 60);

            document.getElementById('timeDuration').textContent = `${hours}:${minutes.toString().padStart(2, '0')}`;
            document.getElementById('timeHours').textContent = hours;
            document.getElementById('timeMinutes').textContent = minutes;
            document.getElementById('timeSeconds').textContent = seconds;
            document.getElementById('timeResults').style.display = 'block';
        }

        // --- Percentage Calculator ---
        function calculatePercentage() {
            const valueRaw = document.getElementById('value').value;
            const percentageRaw = document.getElementById('percentageValue').value;
            console.log('Raw Value:', valueRaw, 'Raw Percentage:', percentageRaw);
            const value = parseFloat(valueRaw);
            const percentage = parseFloat(percentageRaw);
            console.log('Parsed Value:', value, 'Parsed Percentage:', percentage);

            if (isNaN(value) || isNaN(percentage)) {
                alert('Please enter valid numbers for both value and percentage');
                document.getElementById('percentageResults').style.display = 'none';
                return;
            }

            const percentageOfValue = value * (percentage / 100);
            const valueIncreased = value + percentageOfValue;
            const valueDecreased = value - percentageOfValue;

            // Format numbers to 2 decimal places
            document.getElementById('percentageOfValue').textContent = percentageOfValue.toFixed(2);
            document.getElementById('valueIncreased').textContent = valueIncreased.toFixed(2);
            document.getElementById('valueDecreased').textContent = valueDecreased.toFixed(2);
            
            // Show the results
            document.getElementById('percentageResults').style.display = 'block';

            // Add to history
            addToHistory('percentage',
                { value: value, percentage: percentage },
                `${percentageOfValue.toFixed(2)} (${valueDecreased.toFixed(2)} to ${valueIncreased.toFixed(2)})`
            );
        }

        // --- Wrap calculation functions to add to history ---
        const originalCalculateAge = calculateAge;
        calculateAge = function() {
            const birthDate = document.getElementById('birthDate').value;
            const currentDate = document.getElementById('currentDate').value;

            originalCalculateAge();

            if (birthDate && currentDate) {
                const years = document.getElementById('ageYears').textContent;
                const months = document.getElementById('ageMonths').textContent;
                const days = document.getElementById('ageDays').textContent;

                addToHistory('age', 
                    { birthDate: birthDate, currentDate: currentDate },
                    `${years} years, ${months} months, ${days} days`
                );
            }
        };

        const originalCalculateDate = calculateDate;
        calculateDate = function() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            originalCalculateDate();

            if (startDate && endDate) {
                const days = document.getElementById('daysBetween').textContent;
                const weeks = document.getElementById('weeksBetween').textContent;
                const months = document.getElementById('monthsBetween').textContent;
                const years = document.getElementById('yearsBetween').textContent;

                addToHistory('date',
                    { startDate: startDate, endDate: endDate },
                    `${days} days, ${weeks} weeks, ${months} months, ${years} years`
                );
            }
        };

        const originalCalculateTime = calculateTime;
        calculateTime = function() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;

            originalCalculateTime();

            if (startTime && endTime) {
                const duration = document.getElementById('timeDuration').textContent;
                const hours = document.getElementById('timeHours').textContent;
                const minutes = document.getElementById('timeMinutes').textContent;
                const seconds = document.getElementById('timeSeconds').textContent;

                addToHistory('time',
                    { startTime: startTime, endTime: endTime },
                    `${duration} (${hours}h ${minutes}m ${seconds}s)`
                );
            }
        };
    </script>
} 